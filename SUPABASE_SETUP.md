# ISTExpert ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∫–∏

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω –ø–æ–¥–æ–π–¥–µ—Ç)
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è (2-3 –º–∏–Ω—É—Ç—ã)

## üìã –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 2.1 –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å—Ö–µ–º—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ –ø–∞–Ω–µ–ª–∏ Supabase: https://app.supabase.com/project/_sql
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `supabase-schema.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ (Run)

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã (companies, users, equipment, maintenance, breakdowns, procurement, –∏ —Ç.–¥.)
- ‚úÖ RLS (Row Level Security) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at

### 2.2 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã:
- `companies` ‚Äî –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `equipment` ‚Äî —Ç–µ—Ö–Ω–∏–∫–∞
- `maintenance_records` ‚Äî –∑–∞–ø–∏—Å–∏ –¢–û
- `breakdowns` ‚Äî –ø–æ–ª–æ–º–∫–∏
- `procurement_requests` ‚Äî –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–Ω–∞–±–∂–µ–Ω–∏–µ
- `planned_tos` ‚Äî –ø–ª–∞–Ω–æ–≤—ã–µ –¢–û
- `fuel_records` ‚Äî —Ç–æ–ø–ª–∏–≤–æ
- `notifications` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `payments` ‚Äî –ø–ª–∞—Ç–µ–∂–∏ (–¥–ª—è –±—É–¥—É—â–µ–π –ÆKassa)

## üìã –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

1. –í –ø–∞–Ω–µ–ª–∏ Supabase –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **API**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Project URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://xxxxx.supabase.co`)
   - **anon/public key** (–¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

## üìã –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
   ```bash
   cp .env.example .env
   ```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
   ```env
   VITE_SUPABASE_URL=https://your-project.supabase.co
   VITE_SUPABASE_ANON_KEY=your-anon-key-here
   VITE_ADMIN_EMAIL=your-email@example.com
   ```

   –ì–¥–µ:
   - `VITE_SUPABASE_URL` ‚Äî URL –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
   - `VITE_SUPABASE_ANON_KEY` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
   - `VITE_ADMIN_EMAIL` ‚Äî –≤–∞—à email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## üìã –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 5.1 –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

1. –í –ø–∞–Ω–µ–ª–∏ Supabase: **Authentication** ‚Üí **Providers**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Email** –≤–∫–ª—é—á–µ–Ω
3. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):
   - **Authentication** ‚Üí **Settings** ‚Üí **Disable email confirmations**

### 5.2 –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã

1. **Authentication** ‚Üí **URL Configuration**
2. –î–æ–±–∞–≤—å—Ç–µ:
   - Site URL: `http://localhost:5173` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
   - Redirect URLs: `http://localhost:5173/*`

## üìã –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ
2. –í–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω 14-–¥–Ω–µ–≤–Ω—ã–π —Ç—Ä–∏–∞–ª
3. –í—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç–µ —Ä–æ–ª—å –≤ Supabase:
   ```sql
   UPDATE users SET role = 'owner' WHERE email = 'your-email@example.com';
   ```

–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –º–∞—Ä—à—Ä—É—Ç `/admin`

## üìã –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 7.1 –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

```bash
npm install
npm run dev
```

### 7.2 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173
2. –ù–∞–∂–º–∏—Ç–µ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∫–æ–º–ø–∞–Ω–∏–∏
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ (–¥–ª—è —Ç–µ—Å—Ç–∞ Free)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

### 7.3 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥

1. –í–æ–π–¥–∏—Ç–µ —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `companies`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users`

### 7.4 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/admin`
2. –ï—Å–ª–∏ –≤–∞—à email —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `VITE_ADMIN_EMAIL` ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π

## üìã –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫

### –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏:

- `trial` ‚Äî –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (14 –¥–Ω–µ–π)
- `active` ‚Äî –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
- `expired` ‚Äî –∏—Å—Ç–µ–∫–ª–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞)
- `suspended` ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (–Ω–µ—Ç –æ–ø–ª–∞—Ç—ã)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–π—Ç–µ Edge Function:

```sql
-- –í –ø–∞–Ω–µ–ª–∏ Supabase: Database ‚Üí Functions ‚Üí New Function
CREATE OR REPLACE FUNCTION check_expired_subscriptions()
RETURNS void AS $$
BEGIN
  UPDATE companies
  SET subscription_status = 'expired'
  WHERE subscription_status IN ('active', 'trial')
  AND subscription_end < NOW();
END;
$$ LANGUAGE plpgsql;
```

–ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ cron job (—Ä–∞–∑ –≤ –¥–µ–Ω—å):
- **Edge Functions** ‚Üí **Schedules** ‚Üí **New Schedule**
- Expression: `0 0 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å)

## üìã –®–∞–≥ 9: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa (–≤ –±—É–¥—É—â–µ–º)

### 9.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

```typescript
const createPayment = async (companyId: string, amount: number) => {
  const response = await fetch('/api/yookassa/create', {
    method: 'POST',
    body: JSON.stringify({
      amount: { value: amount, currency: 'RUB' },
      description: '–û–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ ISTExpert',
      metadata: { company_id: companyId }
    })
  });
  return response.json();
};
```

### 9.2 Webhook –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ Edge Function –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ÆKassa:
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `subscription_status` –Ω–∞ `active`
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ `subscription_end`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS (Row Level Security)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏
- –ê–¥–º–∏–Ω (–≤–ª–∞–¥–µ–ª–µ—Ü) –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Å—ë

### –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞:

1. **companies**: SELECT/UPDATE —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
2. **users**: SELECT –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. **equipment**: ALL –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
4. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

## üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

1. ‚úÖ –í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ production URL –≤ Supabase
3. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ production –¥–æ–º–µ–Ω –≤ redirect URLs
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ `.env` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤—Ö–æ–¥

### Vercel (–∞–≤—Ç–æ–¥–µ–ø–ª–æ–π):

1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel:
   - VITE_SUPABASE_URL
   - VITE_SUPABASE_ANON_KEY
   - VITE_ADMIN_EMAIL

2. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ: `git push`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
SELECT subscription_status, COUNT(*) 
FROM companies 
GROUP BY subscription_status;

-- –ö–æ–º–ø–∞–Ω–∏–∏ —Å –∏—Å—Ç–µ–∫–∞—é—â–µ–π –ø–æ–¥–ø–∏—Å–∫–æ–π (7 –¥–Ω–µ–π)
SELECT name, email, subscription_end 
FROM companies 
WHERE subscription_end BETWEEN NOW() AND NOW() + INTERVAL '7 days';

-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
  (SELECT COUNT(*) FROM companies) as total_companies,
  (SELECT COUNT(*) FROM users) as total_users,
  (SELECT COUNT(*) FROM equipment) as total_equipment;
```

## üÜò Troubleshooting

### –û—à–∏–±–∫–∞: "Invalid API key"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `anon` –∫–ª—é—á, –∞ –Ω–µ `service_role`

### –û—à–∏–±–∫–∞: "Row Level Security"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ RLS policies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Email –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤–∫–ª—é—á–µ–Ω –≤ Supabase
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ **Authentication** ‚Üí **Logs**

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ foreign keys (company_id –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- Supabase: https://supabase.com/docs
- React: https://react.dev
- Vite: https://vitejs.dev

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –§–µ–≤—Ä–∞–ª—å 2026
**–í–µ—Ä—Å–∏—è:** 1.0
